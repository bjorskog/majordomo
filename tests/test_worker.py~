#!/usr/bin/env python

import zmq
import json
import random
import time
import sys

def push_messages(workernum):
    """ generates rngs and pushes """

    context = zmq.Context()
    socket = context.socket(zmq.PUB)
    
    socket.bind('tcp://127.0.0.1:5000')
    socket.setsockopt(zmq.IDENTITY, "worker-%s" % workernum)
    
    while True:
        try:
            msg = json.dumps({'feed': str(random.random())})
            socket.send_multipart(['data.fundamental' msg])
        except KeyboardError:
            pass
        time.sleep(random.random())

if __name__ == "__main__":
    if len(sys.argv)<2:
        workernum = random.randint(1, 100)
    else:
        workernum = sys.argv[1]

    print "Starting worker %i..." % workernum
